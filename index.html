<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebKit CVE-like PoC (SVG Use + Transform)</title>
  <style>
    svg {
      border: 2px solid lime;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>SVG Use + Transform Test</h1>
  <p>Se o WebKit corromper a renderização, travar ou falhar ao clonar elementos, pode indicar falha de segurança.</p>

  <svg width="500" height="500">
    <!-- Definimos um símbolo a ser usado -->
    <defs>
      <rect id="template" x="0" y="0" width="50" height="50" fill="red" />
    </defs>

    <!-- Clonagem com transformação malformada -->
    <use id="u1" href="#template" x="10" y="10" transform="translate(123" />
    <use id="u2" href="#template" x="70" y="10" transform="tran&#x0001;ate(1)" />
    <use id="u3" href="#template" x="130" y="10" transform="translate(9999999999999999999999999)" />
    <use id="u4" href="#template" x="10" y="70" transform="translate(0)" />
  </svg>

  <script>
    // Stress via DOM manipulação
    const ids = ["u1", "u2", "u3", "u4"];
    let count = 0;

    function stressShadowTree() {
      for (const id of ids) {
        const el = document.getElementById(id);
        // Reaplica o transform para forçar rebuild da shadow tree
        el.setAttribute("transform", el.getAttribute("transform"));
        // Força render/layout
        const bbox = el.getBBox();
        console.log(`${id} bbox:`, bbox.x, bbox.y);
      }

      count++;
      if (count < 200) requestAnimationFrame(stressShadowTree);
    }

    stressShadowTree();
  </script>
</body>
</html>
