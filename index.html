<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SVG Remove and Reinsert Stress</title>
  <style>
    body {
      background: #fff;
      color: #000;
      font-family: sans-serif;
    }
    svg {
      border: 2px solid red;
      display: block;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <h2>SVG Stress: removeChild + appendChild + transform</h2>
  <p>Se renderização corromper ou travar, pode indicar bug grave no WebKit.</p>

  <svg id="svgRoot" width="1000" height="1000" viewBox="-1000 -1000 2000 2000">
    <defs>
      <rect id="baseRect" x="0" y="0" width="40" height="40" fill="red"/>
    </defs>
  </svg>

  <script>
    const svg = document.getElementById("svgRoot");
    const container = document.createElementNS("http://www.w3.org/2000/svg", "g");
    svg.appendChild(container);

    const clones = [];
    const base = document.getElementById("baseRect");

    // Criação inicial dos clones
    for (let i = 0; i < 30; i++) {
      const clone = base.cloneNode();
      clone.setAttribute("transform", `translate(${Math.random()*2000 - 1000}, ${Math.random()*2000 - 1000}) rotate(${Math.random()*360})`);
      clones.push(clone);
      container.appendChild(clone);
    }

    let toggle = false;
    function stress() {
      // Alterna entre remover e reinserir os nós
      if (toggle) {
        for (const el of clones) container.removeChild(el);
      } else {
        for (const el of clones) container.appendChild(el);
      }
      toggle = !toggle;

      requestAnimationFrame(stress);
    }

    stress();
  </script>
</body>
</html>
