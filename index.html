<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebKit Stress Test (SVG Use + Transform)</title>
  <style>
    svg {
      border: 2px solid lime;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>WebKit Stress Test - SVG Use + Transform</h1>
  <p>Se o WebKit corromper a renderização ou travar, pode indicar falha de segurança.</p>

  <svg id="svgContainer" width="1000" height="1000">
    <defs>
      <rect id="template" x="0" y="0" width="50" height="50" fill="red" />
    </defs>
  </svg>

  <script>
    const svgContainer = document.getElementById("svgContainer");
    let count = 0;

    function stressSVG() {
      // Criar novo <use> com transformação malformada
      const use = document.createElementNS("http://www.w3.org/2000/svg", "use");
      use.setAttribute("href", "#template");
      use.setAttribute("x", 10 + (count * 60));
      use.setAttribute("y", 10);
      use.setAttribute("transform", "translate(" + (Math.random() * 1000) + ")");
      svgContainer.appendChild(use);

      // Log de controle
      console.log(`Adicionando #use${count} com transform: translate(${Math.random() * 1000})`);

      // Reaplicar forçadamente
      const bbox = use.getBBox();
      console.log(`Bbox do #use${count}:`, bbox.x, bbox.y);

      count++;

      if (count < 200) requestAnimationFrame(stressSVG);
    }

    stressSVG();
  </script>
</body>
</html>
