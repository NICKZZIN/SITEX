<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SVG CloneNode Stress Test</title>
  <style>
    body {
      background: #fff;
      color: #000;
      font-family: sans-serif;
    }
    svg {
      border: 2px solid red;
      display: block;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <h2>SVG Use + cloneNode + transform Stress Test</h2>
  <p>Observe lentidão, corrupção visual ou falhas ao clonar ou renderizar elementos.</p>

  <svg id="svgRoot" width="1000" height="1000" viewBox="-1000 -1000 2000 2000">
    <defs>
      <rect id="baseRect" x="0" y="0" width="40" height="40" fill="red"/>
    </defs>
  </svg>

  <script>
    const svg = document.getElementById("svgRoot");
    let iteration = 0;

    function generateGlitch() {
      const base = document.getElementById("baseRect");

      // Cria um grupo (g) para agrupar clones
      const g = document.createElementNS("http://www.w3.org/2000/svg", "g");

      for (let i = 0; i < 15; i++) {
        const clone = base.cloneNode();
        const tx = Math.random() * 2000 - 1000;
        const ty = Math.random() * 2000 - 1000;
        const rot = Math.random() * 360;
        const sc = 0.5 + Math.random() * 1.5;

        clone.setAttribute("transform", `translate(${tx}, ${ty}) rotate(${rot}) scale(${sc})`);
        g.appendChild(clone);
      }

      svg.appendChild(g);

      iteration++;
      if (iteration < 500) {
        requestAnimationFrame(generateGlitch);
      }
    }

    generateGlitch();
  </script>
</body>
</html>
