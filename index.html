<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DOM Manipulation Stress Test</title>
  <style>
    body {
      background: #fff;
      color: #000;
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <h2>DOM Manipulation Stress</h2>
  <p>Alterações rápidas de DOM e execuções em loop podem causar falhas ou corrupção.</p>

  <div id="root"></div>

  <script>
    const root = document.getElementById('root');
    let counter = 0;

    function randomElement() {
      const div = document.createElement('div');
      div.style.width = `${Math.random() * 200}px`;
      div.style.height = `${Math.random() * 200}px`;
      div.style.backgroundColor = `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})`;
      root.appendChild(div);
    }

    function recursiveManipulation() {
      if (counter % 100 === 0) {
        // Remove e reinserir elementos
        root.innerHTML = '';
      }

      // Criar novos elementos ou modificar existentes
      for (let i = 0; i < 10; i++) {
        randomElement();
      }

      // Alterações rápidas nos elementos
      const divs = root.getElementsByTagName('div');
      for (let div of divs) {
        div.style.left = `${Math.random() * 2000}px`;
        div.style.top = `${Math.random() * 2000}px`;
      }

      // Chamar novamente após um curto intervalo
      counter++;
      if (counter < 1000) {
        setTimeout(recursiveManipulation, 0);
      }
    }

    recursiveManipulation();
  </script>
</body>
</html>
