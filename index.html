<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebKit Stress Test - Extreme Corruption and Failures</title>
  <style>
    svg {
      border: 2px solid lime;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>WebKit Stress Test - Extreme Corruption and Failures</h1>
  <p>Se o WebKit corromper a renderização ou travar, isso pode indicar falha de segurança.</p>

  <svg id="svgContainer" width="1000" height="1000" viewBox="-40000 -40000 50000 50000">
    <defs>
      <rect id="template" x="0" y="0" width="50" height="50" fill="red" />
    </defs>
  </svg>

  <script>
    const svgContainer = document.getElementById("svgContainer");
    let count = 0;

    function stressOverflow() {
      // Criar novo <use> com transformações ainda mais desordenadas e aleatórias
      const use = document.createElementNS("http://www.w3.org/2000/svg", "use");
      use.setAttribute("href", "#template");

      // Gera transformações extremamente aleatórias para gerar mais caos
      const randomX = Math.random() * 55087 - 45087; // Movendo mais elementos fora da tela
      const randomY = Math.random() * 55087 - 45087; // Movendo mais elementos fora da tela
      const rotate = Math.random() * 2587; // Rotação aumentada ainda mais
      const scale = Math.random() * 1000;  // Escala aumentada ainda mais para distorcer
      const translate = `translate(${randomX}, ${randomY}) rotate(${rotate}deg) scale(${scale})`;

      use.setAttribute("transform", translate);

      svgContainer.appendChild(use);

      // Log para monitoramento
      console.log(`Adicionando #use${count} com transform: ${translate}`);

      count++;

      // Continue até 5000 elementos para forçar mais caos
      if (count < 15087) requestAnimationFrame(stressOverflow);
    }

    stressOverflow();

    // Animações contínuas para forçar ainda mais a falha
    function continuousTransform() {
      const uses = svgContainer.querySelectorAll('use');
      uses.forEach(use => {
        const randomX = Math.random() * 55087 - 45087;
        const randomY = Math.random() * 55087 - 45087;
        const rotate = Math.random() * 2587;
        const scale = Math.random() * 1000;
        const transform = `translate(${randomX}, ${randomY}) rotate(${rotate}deg) scale(${scale})`;

        use.setAttribute("transform", transform);
      });

      requestAnimationFrame(continuousTransform);  // Continuar a animação
    }

    continuousTransform();  // Iniciar animação contínua
  </script>
</body>
</html>
