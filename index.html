<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SVG Stress Without foreignObject</title>
  <style>
    body { background: #fff; font-family: sans-serif; margin: 0; padding: 0; }
    h1 { text-align: center; }
    svg { display: block; margin: 0 auto; border: 2px solid black; width: 100vw; height: 100vh; }
  </style>
</head>
<body>
  <h1>Stress Test: &lt;use&gt; cloning complex SVG shapes</h1>
  <svg id="svg" viewBox="-500 -500 1000 1000" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
      <g id="complex">
        <rect x="-50" y="-50" width="100" height="100" fill="red" stroke="black" stroke-width="4"/>
        <circle cx="0" cy="0" r="30" fill="blue" />
        <path d="M -40,-40 Q 0,-80 40,-40 T 40,40" fill="none" stroke="green" stroke-width="3"/>
        <text x="-40" y="60" font-size="12" fill="purple">Test</text>
      </g>
    </defs>
  </svg>

  <script>
    const svg = document.getElementById('svg');
    let iteration = 0;

    function stressCloneUse() {
      const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');
      use.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', '#complex');

      // Random transformation
      const tx = Math.random() * 1000 - 500;
      const ty = Math.random() * 1000 - 500;
      const scale = 0.5 + Math.random() * 2;
      const rotate = Math.random() * 360;
      use.setAttribute('transform', `translate(${tx},${ty}) scale(${scale}) rotate(${rotate})`);

      svg.appendChild(use);
      console.log(`[clone+transform] inserted ${iteration}`);

      // Remove after a short delay
      setTimeout(() => {
        if (svg.contains(use)) svg.removeChild(use);
        console.log(`[clone+transform] removed ${iteration}`);
      }, 500 + Math.random() * 1000);

      iteration++;
      if (iteration < 300) requestAnimationFrame(stressCloneUse);
    }

    stressCloneUse();
  </script>
</body>
</html>
