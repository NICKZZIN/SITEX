<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SVG Dynamic Attribute Stress</title>
  <style>
    body {
      background: #fff;
      color: #000;
      font-family: sans-serif;
    }
    svg {
      border: 2px solid red;
      display: block;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <h2>SVG cloneNode + dynamic attr modification test</h2>
  <p>Se a renderização quebrar ou travar ao rolar, pode indicar falha de segurança no WebKit.</p>

  <svg id="svgRoot" width="1000" height="1000" viewBox="-1000 -1000 2000 2000">
    <defs>
      <rect id="baseRect" x="0" y="0" width="40" height="40" fill="red"/>
    </defs>
  </svg>

  <script>
    const svg = document.getElementById("svgRoot");
    const clones = [];
    let iteration = 0;

    function createClones() {
      const base = document.getElementById("baseRect");

      for (let i = 0; i < 15; i++) {
        const clone = base.cloneNode();
        const tx = Math.random() * 2000 - 1000;
        const ty = Math.random() * 2000 - 1000;
        const rot = Math.random() * 360;
        const sc = 0.5 + Math.random() * 1.5;

        clone.setAttribute("transform", `translate(${tx}, ${ty}) rotate(${rot}) scale(${sc})`);
        svg.appendChild(clone);
        clones.push(clone);
      }
    }

    function mutateAttributes() {
      for (const el of clones) {
        el.setAttribute("x", Math.random() * 100 - 50);
        el.setAttribute("y", Math.random() * 100 - 50);
        el.setAttribute("width", Math.random() * 200);
        el.setAttribute("height", Math.random() * 200);
      }

      iteration++;
      if (iteration < 1000) {
        requestAnimationFrame(mutateAttributes);
      }
    }

    createClones();
    mutateAttributes();
  </script>
</body>
</html>
