<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Advanced cloneNode + Mutation Stress</title>
  <style>
    body { background: #fff; color: #000; font-family: sans-serif; }
    svg { border: 2px solid #444; margin: 10px; display: block; }
  </style>
</head>
<body>
  <h1>Advanced cloneNode Mutation Test</h1>
  <p>Testando possíveis corrupções via clones SVG e mutações agressivas.</p>

  <svg id="svg" viewBox="-500 -500 1000 1000" width="600" height="600"></svg>

  <script>
    const svg = document.getElementById('svg');
    const base = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    base.setAttribute('width', '20');
    base.setAttribute('height', '20');
    base.setAttribute('fill', 'blue');

    const clones = [];
    const count = 150;

    // Cria e posiciona vários clones com transformações randômicas
    for (let i = 0; i < count; i++) {
      const c = base.cloneNode();
      const x = Math.random() * 800 - 400;
      const y = Math.random() * 800 - 400;
      c.setAttribute('x', x);
      c.setAttribute('y', y);
      svg.appendChild(c);
      clones.push(c);
    }

    console.log('[Advanced] Clones criados:', clones.length);

    let iter = 0;
    function mutate() {
      clones.forEach((el, i) => {
        el.setAttribute('width', Math.random() * 1000 - 500);
        el.setAttribute('height', Math.random() * 1000 - 500);
        el.setAttribute('x', Math.random() * 1000 - 500);
        el.setAttribute('y', Math.random() * 1000 - 500);
        el.setAttribute('rx', Math.random() * 200);
        el.setAttribute('ry', Math.random() * 200);
        el.setAttribute('transform', `rotate(${Math.random()*360}) scale(${Math.random()*5})`);
        el.style.stroke = `rgb(${Math.random()*255},${Math.random()*255},${Math.random()*255})`;
        el.style.strokeWidth = Math.random() * 10;
      });
      iter++;
      console.log(`[Advanced] Iteration ${iter}`);
      if (iter < 300) requestAnimationFrame(mutate);
    }

    mutate();
  </script>
</body>
</html>
