function log(msg) {
    const p = document.createElement("p");
    p.textContent = msg;
    document.body.appendChild(p);
}

try {
    const ab = new ArrayBuffer(0x1000, { "maxByteLength": 0x4000 });
    const u8 = new Uint8Array(ab);

    log("Inicial - ab.byteLength: " + ab.byteLength);

    function call_back() {
        log("Callback executado. Tentando reduzir o buffer...");
        try {
            ab.resize(0);
            log("Resize bem-sucedido.");
        } catch (e) {
            log("Erro ao tentar resize: " + e);
        }
        return 0;
    }

    u8.copyWithin(0x20, { valueOf: call_back });

    log("Ap√≥s copyWithin - ab.byteLength: " + ab.byteLength);
} catch (e) {
    log("Erro geral: " + e);
}
